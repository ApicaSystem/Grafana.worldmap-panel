{"version":3,"sources":["../src/worldmap_ctrl_apica.js"],"names":["WorldmapCtrlOriginal","$","panelDefaultsApica","locationData","tableLabel","circleMinSize","circleMaxSize","showLegend","thresholds","colors","editTabIndex","WorldmapCtrl","$scope","$injector","contextSrv","panel","_","assign","cloneDeep","events","on","tweakOriginalEditor","bind","snapshotData","map","setTimeout","render","addEditorTab","pluginId","newIndex","editTabElementName","find","closest","hide","siblings","text"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAOA,0B;;AAEAC,O;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEDC,wB,GAAqB;AACzBC,sBAAc,OADW;AAEzBC,oBAAY,aAFa;AAGzBC,uBAAe,CAHU;AAIzBC,uBAAe,CAJU;AAKzBC,oBAAY,KALa;;AAOzBC,oBAAY,SAPa;AAQzBC,gBAAQ,CACN,uBADM,EAEN,yBAFM,EAGN,yBAHM,EAIN,0BAJM,EAKN,wBALM;AARiB,O;AAiBrBC,kB,GAAe,C;;AAEAC,kB;;;AAEnB,8BAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,UAA/B,EAA2C;AAAA;;AAAA,kIACnCF,MADmC,EAC3BC,SAD2B,EAChBC,UADgB;;AAGzC;AACA,cAAI,CAAC,MAAKC,KAAL,CAAWX,UAAhB,EAA4B;AAC1BY,cAAEC,MAAF,CAAS,MAAKF,KAAd,EAAqBC,EAAEE,SAAF,CAAYhB,kBAAZ,CAArB;AACD;;AAED,gBAAKiB,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,MAAKC,mBAAL,CAAyBC,IAAzB,OAAzB;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,SAAf,EAA0B,MAAKC,mBAAL,CAAyBC,IAAzB,OAA1B;AATyC;AAU1C;;;;6CAEkBC,Y,EAAc;AAAA;;AAC/B,2IAAyBA,YAAzB;AACA;AACA,gBAAI,CAAC,KAAKC,GAAV,EAAe;AACbC,yBAAW,YAAM;AACf,uBAAKC,MAAL;AACD,eAFD,EAEG,GAFH;AAGD;AACF;;;2CAEgB;AACf;AACA,iBAAKC,YAAL,CAAkB,UAAlB,sBAAgD,KAAKC,QAArD,4BAAsFlB,YAAtF;AACD;;;oCAESmB,Q,EAAU;AAClB,kIAAgBA,QAAhB;AACA,iBAAKR,mBAAL;AACD;;;gDAEqB;AACpB,gBAAIS,2CAAyC,KAAKF,QAA9C,GAAyDlB,YAA7D;AACAe,uBAAW,YAAM;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACAxB,uCAAuB6B,kBAAvB,EACGC,IADH,oVAQKC,OARL,CAQa,UARb,EAQyBC,IARzB;;AAUA;AACA;AACA;AACAhC,uCAAuB6B,kBAAvB,EACGC,IADH,6HAIKC,OAJL,CAIa,gBAJb,EAI+BC,IAJ/B;;AAMAhC,uCAAuB6B,kBAAvB,kDAAwFI,QAAxF,CAAiG,gBAAjG,EAAmHC,IAAnH,CAAwH,aAAxH;AAED,aA7BD,EA6BG,GA7BH;AA8BD;;;mCAEQ;AACP;AACA,iBAAKpB,KAAL,CAAWT,aAAX,GAA2B,KAAKS,KAAL,CAAWV,aAAtC;AACA;AACD;;;;QAxEuCL,oB;;yBAArBW,Y","file":"worldmap_ctrl_apica.js","sourcesContent":["import WorldmapCtrlOriginal from './worldmap_ctrl';\r\n\r\nimport $ from 'jquery';\r\n\r\nconst panelDefaultsApica = {\r\n  locationData: 'table',\r\n  tableLabel: 'summaryHtml',\r\n  circleMinSize: 5,\r\n  circleMaxSize: 5,\r\n  showLegend: false,\r\n\r\n  thresholds: '1,2,3,4',\r\n  colors: [\r\n    'rgba(90, 98, 90, 0.9)',\r\n    'rgba(50, 172, 45, 0.97)',\r\n    'rgba(224, 210, 0, 0.97)',\r\n    'rgba(237, 129, 40, 0.89)',\r\n    'rgba(245, 54, 54, 0.9)'\r\n  ]\r\n};\r\n\r\nconst editTabIndex = 2;\r\n\r\nexport default class WorldmapCtrl extends WorldmapCtrlOriginal {\r\n\r\n  constructor($scope, $injector, contextSrv) {\r\n    super($scope, $injector, contextSrv);\r\n\r\n    // tableLabel is not initiated in parent by default, so this is the mark that here we should init Apica checks summary by location format. \r\n    if (!this.panel.tableLabel) {\r\n      _.assign(this.panel, _.cloneDeep(panelDefaultsApica));\r\n    }\r\n\r\n    this.events.on('render', this.tweakOriginalEditor.bind(this));\r\n    this.events.on('refresh', this.tweakOriginalEditor.bind(this));\r\n  }\r\n\r\n  onDataSnapshotLoad(snapshotData) {\r\n    super.onDataSnapshotLoad(snapshotData);\r\n    // a hack to make sure that map is initialized (it doesn't happen in time when work in snapshot mode) \r\n    if (!this.map) {\r\n      setTimeout(() => {\r\n        this.render();\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n  onInitEditMode() {\r\n    // tab will be added as a tag with name 'panel-editor-tab-{pluginId}{editTabIndex}', for example: <panel-editor-tab-apica-worldmap-panel2> \r\n    this.addEditorTab('Worldmap', `public/plugins/${this.pluginId}/partials/editor.html`, editTabIndex);\r\n  }\r\n\r\n  changeTab(newIndex) {\r\n    super.changeTab(newIndex);\r\n    this.tweakOriginalEditor();\r\n  }\r\n\r\n  tweakOriginalEditor() {\r\n    let editTabElementName = `panel-editor-tab-${this.pluginId}${editTabIndex}`;\r\n    setTimeout(() => {\r\n      // hide not useless Map Visual Options:\r\n      // - Max Circle Size - circle sizes should be the same for now\r\n      // - Decimals - metric is used for the color, so decimals settings is useless\r\n      // - Unit - same as Decimals\r\n      // - Show Legend - legend shows metric values, but they as color codes are useless\r\n      // - Location Data - should always be 'table' (ASM Datasource provides data in table format)\r\n      // - Aggregation - not used, 'metric' property from data source is always used\r\n      $(`.tabbed-view-body ${editTabElementName}`)\r\n        .find(`\r\n          input[ng-model=\"ctrl.panel.circleMaxSize\"],\r\n          input[ng-model=\"ctrl.panel.decimals\"],\r\n          input[ng-model=\"ctrl.panel.unitSingular\"],\r\n          gf-form-switch[checked=\"ctrl.panel.showLegend\"],\r\n          select[ng-model=\"ctrl.panel.locationData\"],\r\n          select[ng-model=\"ctrl.panel.valueName\"]\r\n        `).closest('.gf-form').hide();\r\n\r\n      // hide not useless Map Visual Options:\r\n      // - Threshold Options (Thresholds, Colors) - thresholds are used for circles coloring that \r\n      // - Hide series (With only nulls, With only zeros)\r\n      $(`.tabbed-view-body ${editTabElementName}`)\r\n        .find(`\r\n          input[ng-model=\"ctrl.panel.thresholds\"],\r\n          gf-form-switch[checked=\"ctrl.panel.hideEmpty\"]\r\n        `).closest('.gf-form-group').hide();\r\n      \r\n      $(`.tabbed-view-body ${editTabElementName} input[ng-model=\"ctrl.panel.circleMinSize\"]`).siblings('.gf-form-label').text('Circle Size');\r\n            \r\n    }, 100);\r\n  }\r\n  \r\n  render() {\r\n    // different circle sizes in current implementation has no sence, so we adjust them to be equal.\r\n    this.panel.circleMaxSize = this.panel.circleMinSize;\r\n    super.render();\r\n  }\r\n}"]}